---

title: Convert


keywords: fastai
sidebar: home_sidebar

summary: "The Jupyter Notebooks need to be turned into either Markdown or HTML documents to be compatible with the Medium API. Quite good tools to do just this already exists such as Jupyter's `nbconvert` so we are going to use just that."
description: "The Jupyter Notebooks need to be turned into either Markdown or HTML documents to be compatible with the Medium API. Quite good tools to do just this already exists such as Jupyter's `nbconvert` so we are going to use just that."
nb_path: "nbs/01_convert.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_convert.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - GITHUB_TOKEN environment variable found.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Jupyter-nbconvert">Jupyter nbconvert<a class="anchor-link" href="#Jupyter-nbconvert"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Jupyter's nbconvert is a well established tool created and maintained by the core jupyter developers. There is no need to reinvent the wheel, hence we will be using <code>nbconvert</code>'s python API to convert Jupyter Notebook to Markdown documents. You can read more about <code>nbconvert</code>'s function in the <a href="https://nbconvert.readthedocs.io/en/latest/nbconvert_library.html">official documentation</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will be using <code>Exporter</code>, namely the <code>MarkdownExporter</code> which can read a python notebook and extract the main body (text) and resources (images, etc). Let's first see the basics of how it works and then make a thin wrapper function around it.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MarkdownExporter</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">body</span><span class="p">,</span> <span class="n">resources</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-notebook.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All notebook exporters return a tuple containing the body and the resources of the document, for instance the matplotlib image from our test notebook was stored as <code>output_4_1.png</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resources</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="s1">&#39;output_4_0.png&#39;</span><span class="p">];</span>
<span class="n">resources</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;output_4_0.png&#39;, &#39;output_6_0.png&#39;, &#39;output_8_0.png&#39;, &#39;output_8_1.png&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Also it is important to know that so far, the notebook markdown representation only exists as a python object and no files have been written.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">nb2md_draft</span><span class="p">(</span><span class="n">notebook</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Paper thin wrapper around nbconvert.MarkdownExporter. This function takes the path to a jupyter</span>
<span class="sd">    notebook and passes it to `MarkdownExporter().from_filename` which returns the body and resources</span>
<span class="sd">    of the document</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">MarkdownExporter</span><span class="p">()</span>
    <span class="n">body</span><span class="p">,</span> <span class="n">resources</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="n">notebook</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">body</span><span class="p">,</span> <span class="n">resources</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a very basic notebook-to-markdown converter that is greatly improved and features are added to it with preprocessors further down in this module, hence this <code>nb2md()</code> function is not the one that will be exported and is hence marked as draft.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">nb2md_draft</span><span class="p">(</span><span class="s1">&#39;../samples/test-notebook.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setting-up-a-module-logger">Setting up a module logger<a class="anchor-link" href="#Setting-up-a-module-logger"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="init_convert_logger" class="doc_header"><code>init_convert_logger</code><a href="https://github.com/lc5415/nb2medium/tree/master/nb2medium/convert.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>init_convert_logger</code>(<strong><code>level</code></strong>=<em><code>20</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;converter&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;debug message&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;info message&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;warn message&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;error message&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;critical message&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - debug message
converter:INFO - info message
converter:WARNING - warn message
converter:ERROR - error message
converter:CRITICAL - critical message
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Writing-Notebook-to-file">Writing Notebook to file<a class="anchor-link" href="#Writing-Notebook-to-file"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We use the <code>FilesWriter</code> object to write the resulting markdown file onto our laptop's storage. We can precise the <code>build_directory</code> attribute (<a href="https://nbconvert.readthedocs.io/en/latest/config_options.html#writer-options">see more Writer options</a>) to indicate where we would like to store our Notebook and the auxiliary files (images, etc). The FilesWriter is "aggresive", meaning it will overwrite whatever files exists if there is a directory or filename clash. Lastly, it is also possible to write a custom Writer such as <code>MediumWriter</code> that renders the document and then uploads it to Medium but because I am learning I'd rather see every step in the pipeline.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">FilesWriter</span><span class="p">(</span><span class="n">build_directory</span> <span class="o">=</span> <span class="s1">&#39;Rendered/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Conveniently, the <code>write()</code> method of <code>FilesWriter</code> returns the output path.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span> <span class="o">=</span> <span class="n">body</span><span class="p">,</span> 
        <span class="n">resources</span> <span class="o">=</span> <span class="n">resources</span><span class="p">,</span>
        <span class="n">notebook_name</span> <span class="o">=</span> <span class="s1">&#39;test-notebook&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Rendered/test-notebook.md&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Simple-writing-function">Simple writing function<a class="anchor-link" href="#Simple-writing-function"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WriteMarkdown" class="doc_header"><code>WriteMarkdown</code><a href="https://github.com/lc5415/nb2medium/tree/master/nb2medium/convert.py#L40" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WriteMarkdown</code>(<strong><code>body</code></strong>, <strong><code>resources</code></strong>, <strong><code>dir_path</code></strong>=<em><code>None</code></em>, <strong><code>filename</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>body &amp; resources are the output of any Jupyter nbconvert <code>Exporter</code>.
dir_path should be a relative path with respect to the current working directory.
If dir_path is not passed, the output document and its auxiliary files will be written
to the same location than the input jupyter notebook
filename should be the output document's name</p>
<p>This function returns the location of the newly written file</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example-1---Write-to-Jupyter's-Notebook-directory">Example 1 - Write to Jupyter's Notebook directory<a class="anchor-link" href="#Example-1---Write-to-Jupyter's-Notebook-directory"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">WriteMarkdown</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;test-notebook&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:INFO - Markdown document written to ../samples/test-notebook.md
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example-2---Write-to-new-directory">Example 2 - Write to new directory<a class="anchor-link" href="#Example-2---Write-to-new-directory"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">WriteMarkdown</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span> <span class="s1">&#39;Docs&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span> <span class="s1">&#39;test-notebook&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:INFO - Markdown document written to Docs/test-notebook.md
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example-3---Write-to-directory-with-subdirectory">Example 3 - Write to directory with subdirectory<a class="anchor-link" href="#Example-3---Write-to-directory-with-subdirectory"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">WriteMarkdown</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span> <span class="s1">&#39;Docs/Attempt1&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span> <span class="s1">&#39;test-notebook&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:INFO - Markdown document written to Docs/Attempt1/test-notebook.md
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example-4---Write-outside-the-current-working-directory">Example 4 - Write outside the current working directory<a class="anchor-link" href="#Example-4---Write-outside-the-current-working-directory"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">WriteMarkdown</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span> <span class="s1">&#39;../Docs&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span> <span class="s1">&#39;test-notebook&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:INFO - Markdown document written to ../Docs/test-notebook.md
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Handling-special-tags">Handling special tags<a class="anchor-link" href="#Handling-special-tags"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Hide-tags---Remove-cell-if-cell-has-no-output">Hide tags - Remove cell if cell has no output<a class="anchor-link" href="#Hide-tags---Remove-cell-if-cell-has-no-output"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We may wish certain markdown or code cells to not be present in the output document. To achieve this we can use <code>nbconvert</code>'s <code>RegexRemovePreprocessor</code>. preprocessors such as this one can either be registered to an <code>Exporter</code>(see <a href="https://nbconvert.readthedocs.io/en/latest/api/exporters.html#nbconvert.exporters.Exporter.register_preprocessor">how</a>) or passed as part of a config (see <a href="https://nbconvert.readthedocs.io/en/latest/removing_cells.html#removing-pieces-of-cells-using-cell-tags">how</a>).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MarkdownExporter</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">register_preprocessor</span><span class="p">(</span><span class="n">RegexRemovePreprocessor</span><span class="p">(</span><span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;^#\s*hide-cell&#39;</span><span class="p">]),</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Funnily enough</strong>, the <code>RegexRemovePreprocessor</code> <a href="https://github.com/jupyter/nbconvert/issues/1091">only hides cells that have the tag AND that do no produce an output</a>. For example:</p>
<div class="highlight"><pre><span></span><span class="c1">#hide-cell</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
<p>would be removed, but:</p>
<div class="highlight"><pre><span></span><span class="c1">#hide-cell</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="c1"># or simply a</span>
<span class="err">`</span>
</pre></div>
<p>would <em>not</em> be removed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Clear-Output---Remove-cell's-output-but-keep-cell's-content">Clear Output - Remove cell's output but keep cell's content<a class="anchor-link" href="#Clear-Output---Remove-cell's-output-but-keep-cell's-content"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The standard preprocessors aren't really useful for what I want to do. <code>RegexRemovePreprocessors</code> only remove cells if they have no output in addition to matching the pattern(s) specified. The <code>ClearOuputPreprocessor</code> removes all outputs from a notebook. Hence I am just going to write a custom preprocessor that is able to hide either a cell's source, a cell's output or the whole cell based on pattern matching performed on a cell's source. After some investigation I realised that best way to achieve this was using <a href="https://stackoverflow.com/a/48084050/12821043">cell tags</a>, though I do not like Jupyter's current tag environment. I do not like them because you have to use the GUI entirely to add tags to a cell, navigating to the the top sidebar, then the <strong>View</strong> section and then the <strong>Cell Toolbar</strong> sub-section and finally click on <strong>Tags</strong> to enable this extra chunky section added to all your cells, even those you may not want to add tag onto. <em>Hence</em> I've gone for an implementation that allows for both the use of tags and the of use of text/regex based tagging in the custom preprocessor <a href="/nb2medium/convert.html#HidePreprocessor"><code>HidePreprocessor</code></a> written below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HidePreprocessor" class="doc_header"><code>class</code> <code>HidePreprocessor</code><a href="https://github.com/lc5415/nb2medium/tree/master/nb2medium/convert.py#L67" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HidePreprocessor</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Preprocessor that hides cell's body and only keeps the output based on regex matching</p>
<p>Regex matching is based on the [RegexRemovePreprocessor source]
(<a href="https://github.com/jupyter/nbconvert/blob/master/nbconvert/preprocessors/regexremove.py">https://github.com/jupyter/nbconvert/blob/master/nbconvert/preprocessors/regexremove.py</a>)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>nbconvert</code> uses <code>traitlets</code> where I would normally expect an <code>__init__()</code> method. Luckily it is quite intuitive to work with traitlets but I do not grasp the pros and cons of using it.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MarkdownExporter</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">register_preprocessor</span><span class="p">(</span><span class="n">HidePreprocessor</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;source&#39;</span><span class="p">),</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">register_preprocessor</span><span class="p">(</span><span class="n">HidePreprocessor</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;output&#39;</span><span class="p">),</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">register_preprocessor</span><span class="p">(</span><span class="n">HidePreprocessor</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span><span class="p">),</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">register_preprocessor</span><span class="p">(</span>
    <span class="n">TagRemovePreprocessor</span><span class="p">(</span>
        <span class="n">remove_input_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;hide-source&#39;</span><span class="p">,),</span>
        <span class="n">remove_all_outputs_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;hide-output&#39;</span><span class="p">,),</span>
        <span class="n">remove_cell_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;hide-cell&#39;</span><span class="p">,),</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;nbconvert.preprocessors.tagremove.TagRemovePreprocessor at 0x7f0a2c4aec40&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The file <code>test-hiding.ipynb</code> contains 4 cells printing the string 'My name is Jack'. The first one has no tags added. The second one has the <code>#hide-source</code> tag which results in only the output string being present in the Markdown document. The third cell has the <code>#hide-output</code> tag added to it which results in only the cell source ("the code") being present in the Markdown document. The last cell has the <code>#hide-cell</code> tag which removes the whole cell (source and output) altogether.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-hiding.ipynb&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - Found a hide-source tag in cell #3.
converter:DEBUG - Found a hide-output tag in cell #1.
converter:DEBUG - Found a hide-cell tag in cell #5.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
### The output of the next cell is hidden


```python
#%hide-output
print(&#39;My name is Jack&#39;)
```

### The source of the next cell is hidden

    My name is Jack


### The entire next cell is hidden

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Above</strong> has been the exploration of how to implement hiding cells sources, cells outputs and entire cells based on text based tags. These will be added in the main <code>nb2md()</code> function at the end of this module</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gister-tags">Gister tags<a class="anchor-link" href="#Gister-tags"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I like syntax highlighting in Medium articles and this is only available (to my knowledge) via GitHub Gists. We will be making our own <a href="https://nbconvert.readthedocs.io/en/latest/nbconvert_library.html#Using-different-preprocessors">preprocessor</a> to uploads the source code of cells that start with the special tag <code># gist</code>. Creating a POST request to submit a Github Gist is easy enough, here we have simply translated the <a href="https://docs.github.com/en/rest/reference/gists#create-a-gist">GitHub API</a> to a python request</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The only thing needed to submit GET/POST request via the GitHub API is a github token. In the same way than with the Medium tokens we can have the environment variable declared in our <code>~/.bashrc</code> or <code>~/.zshrc</code> files. The documentation to create a token can be found <a href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token">in this page</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_gh_auth" class="doc_header"><code>check_gh_auth</code><a href="https://github.com/lc5415/nb2medium/tree/master/nb2medium/convert.py#L106" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_gh_auth</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="upload_gist" class="doc_header"><code>upload_gist</code><a href="https://github.com/lc5415/nb2medium/tree/master/nb2medium/convert.py#L120" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>upload_gist</code>(<strong><code>gistname</code></strong>, <strong><code>gistcontent</code></strong>, <strong><code>description</code></strong>=<em><code>''</code></em>, <strong><code>public</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>description: Description of gist, i.e. some metatext explaining what the gist is about
gistname: name displayed for the gist, this impacts how the file is rendered based
on the extension (e.g. script.py, README.md, script.R, query.sql...)
gistcontent: this maybe the name of a file or just a a string describing a program
public: whether the gist should be public or private</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">upload_gist</span><span class="p">(</span><span class="s1">&#39;ghapitest&#39;</span><span class="p">,</span> <span class="n">gistcontent</span> <span class="o">=</span> <span class="s1">&#39;CONTRIBUTING.md&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(True, &#39;https://gist.github.com/8cdec017e02740fc63bb4669b032a4b5&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I wish to have a gister that acts like a magic function but without being a magic function, instead it's just a set of instruction that are sent to the parser like so:</p>
<div class="highlight"><pre><span></span><span class="c1"># gist description: My python program gistname: script.py public: false upload: source</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span>
</pre></div>
<p>where the <code>public</code>, <code>description</code> and <code>upload</code> flags are optional.</p>
<p>The <code>upload</code> flag exists to enable the user to upload the ouput of a command as a gist too (text file or html table/pandas dataframe). The user can specify what to upload by specifing <code>upload: source</code>, <code>upload: output</code>, <code>upload: both</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Handling-tables">Handling tables<a class="anchor-link" href="#Handling-tables"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">bs4</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># notebook with example dataframe</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../samples/test-gist-output-df.ipynb&quot;</span><span class="p">))[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;text/html&#39;</span><span class="p">]</span> 
<span class="n">soup</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">),</span><span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="p">),</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>9</td>
      <td>hair</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0</td>
      <td>potato</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>water</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We may choose to remove the index column when exporting to csv by running <code>df.to_csv(index = False)</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we know how how to upload a gist to Github and how to recover an html table as a pandas dataframe we can incorporate these method into our own <a href="/nb2medium/convert.html#GisterPreprocessor"><code>GisterPreprocessor</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GisterPreprocessor" class="doc_header"><code>class</code> <code>GisterPreprocessor</code><a href="https://github.com/lc5415/nb2medium/tree/master/nb2medium/convert.py#L150" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GisterPreprocessor</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Preprocessor that detects the presence of the #gist tag in a Jupyter Notebook cell,
uploads the code in that cell as a GitHub gist for the authenticated user and replaces the original cell
for a link to the gist in the resulting markdown file</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - GITHUB_TOKEN environment variable found.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note:</strong> The output of the <em>gisted</em> cell will be removed as the code cell is turned into a markdown cell</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MarkdownExporter</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">register_preprocessor</span><span class="p">(</span><span class="n">GisterPreprocessor</span><span class="p">(),</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;__main__.GisterPreprocessor at 0x7f0a2d53b820&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-gist.ipynb&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - Detected gist tag in cell 1  with arguments: description, gistname; uploading...
converter:INFO - Gist script.py succesfully uploaded!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
## Uploading cells as gists            

[https://gist.github.com/a69b3f06323988f3e688dcff82d6f663](https://gist.github.com/a69b3f06323988f3e688dcff82d6f663)

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">WriteMarkdown</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">r</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;test-gister&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:INFO - Markdown document written to ../samples/test-gister.md
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-gist-output-df.ipynb&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - Detected gist tag in cell 0  with arguments: description, gistname, upload; uploading...
converter:INFO - Gist pandas.py succesfully uploaded!
converter:DEBUG - Found table in cell 0, uploading...
converter:INFO - Gist pandas.py.csv succesfully uploaded!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
[https://gist.github.com/f597cdd0df79b6aa286bdbb7eb6b2c1b](https://gist.github.com/f597cdd0df79b6aa286bdbb7eb6b2c1b)
[https://gist.github.com/7efa870d3157f6f9c755c13e52f59e16](https://gist.github.com/7efa870d3157f6f9c755c13e52f59e16)

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">WriteMarkdown</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">r</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;test-gist-output-df&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:INFO - Markdown document written to ../samples/test-gist-output-df.md
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-gist-output-print.ipynb&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - Detected gist tag in cell 1  with arguments: description, gistname, upload; uploading...
converter:INFO - Gist script.py succesfully uploaded!
converter:DEBUG - Detected printed output in cell 1, uploading...
converter:INFO - Gist script.py.txt succesfully uploaded!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
## Uploading cells as gists            

[https://gist.github.com/7d295d8cdd3c4fef59346d87c80fa14c](https://gist.github.com/7d295d8cdd3c4fef59346d87c80fa14c)
[https://gist.github.com/cae1e18bb80fc44323a9d7999bb3839d](https://gist.github.com/cae1e18bb80fc44323a9d7999bb3839d)

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-gist-multi-mode-output.ipynb&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - Detected gist tag in cell 1  with arguments: description, gistname, upload; uploading...
converter:INFO - Gist script.py succesfully uploaded!
converter:DEBUG - Detected printed output in cell 1, uploading...
converter:INFO - Gist script.py.txt succesfully uploaded!
converter:DEBUG - Found table in cell 1, uploading...
converter:INFO - Gist script.py.txt.csv succesfully uploaded!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
## Uploading cells as gists            

[https://gist.github.com/8311cd1852cede2334d93dd5146c09a7](https://gist.github.com/8311cd1852cede2334d93dd5146c09a7)
[https://gist.github.com/e2946af2ec3361c08e146f02b50cd78d](https://gist.github.com/e2946af2ec3361c08e146f02b50cd78d)
[https://gist.github.com/4924aaebb4aa165e56d7e86f0b0816d8](https://gist.github.com/4924aaebb4aa165e56d7e86f0b0816d8)

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Image-preprocessor">Image preprocessor<a class="anchor-link" href="#Image-preprocessor"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As we have noticed before when we use an <code>nbconvert</code>'s exporter on a Jupyter notebook it extracts the images from that notebook (e.g. plots) and stores them locally. We now need to take those images, upload them to Medium and replace the image with the image URL. It is very similar to what we have done with code cells.m</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice in the cell below how the cells that containg an image have an entry such at <code>cell['outputs']...['data']['image/png'</code>]. We can detect the presence of such file and upload the image to Medium via the python Medium API we have written</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">demonb</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../samples/test-notebook.ipynb&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">demonb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">demonb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dict_keys([&#39;data&#39;, &#39;metadata&#39;, &#39;output_type&#39;]) 
 dict_keys([&#39;image/png&#39;, &#39;text/plain&#39;]) 

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">demonb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;image/png&#39;</span><span class="p">][:</span><span class="mi">200</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;iVBORw0KGgoAAAANSUhEUgAAAYIAAAD4CAYAAADhNOGaAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjMuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8vihELAAAACXBIWXMAAAsTAAALEwEAmpwYAAA5CklEQVR4nO3dd3hU55X48e8Z9QISQjBq&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I am going to make a bold assumption. I am going to assume that if in a given cell the user outputs an image, the user doesn't want anything else to be outputted (e.g. text, or values).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The representation of images in raw Jupyter Notebooks is not actually that of a valid image file, the image is represents with ASCII characters. We need to use <code>binascii.a2b_base64</code> to turns the ASCII characters into binary ones which results in a valid image, which can then upload to medium. I figured this out by exploring how they extract images in <code>nbconvert</code>'s <code>ExtractOutputPreprocessor</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ImagePreprocessor" class="doc_header"><code>class</code> <code>ImagePreprocessor</code><a href="https://github.com/lc5415/nb2medium/tree/master/nb2medium/convert.py#L289" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ImagePreprocessor</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Preprocessor that detects the presence of the image in a Jupyter Notebook cell's output,
uploads the image to Medium</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MarkdownExporter</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">register_preprocessor</span><span class="p">(</span><span class="n">ImagePreprocessor</span><span class="p">(),</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;__main__.ImagePreprocessor at 0x7f0a062950a0&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As we would expect nothing happens when we have a notebook containing online images in it's markdown cells. Medium can access these directly from the internet</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-md-online-image.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:INFO - Detected 0 plots and 0 local images in notebook.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But! If our preprocessor finds offline images, it will upload them to Medium</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-md-offline-image.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - Detected 1 local image(s) in cell 0, uploading...
converter:DEBUG - Image succesfully uploaded to https://cdn-images-1.medium.com/proxy/1*xYdnXpwz3wapR0XTS4aP6Q.png
converter:INFO - Detected 0 plots and 1 local images in notebook.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And finally, if it detects plots such as those coming out of matplotlib, the plot will be uploaded without ever writing the image to memory 😮. In future implementations, more image types can be handles such as plotly interactive plots</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-matplotlib.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - Detected 1 plot(s) in cell 2, uploading...
converter:DEBUG - Image succesfully uploaded to https://cdn-images-1.medium.com/proxy/1*Sr5Vt6FDDMwnWQgU8FV9Rw.png
converter:INFO - Detected 1 plots and 0 local images in notebook.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;../samples/test-multi-matplotlib.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>converter:DEBUG - Detected 1 plot(s) in cell 2, uploading...
converter:DEBUG - Image succesfully uploaded to https://cdn-images-1.medium.com/proxy/1*Sr5Vt6FDDMwnWQgU8FV9Rw.png
converter:DEBUG - Detected 2 plot(s) in cell 2, uploading...
converter:DEBUG - Image succesfully uploaded to https://cdn-images-1.medium.com/proxy/1*ptKG19-sFG7x90-eg5VkoQ.png
converter:INFO - Detected 2 plots and 0 local images in notebook.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Wrapping-it-all-together">Wrapping it all together<a class="anchor-link" href="#Wrapping-it-all-together"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Given all the work we have done making the final function that wraps eveything together is easy! We combine all the tools we have built in this module in the <code>uploader</code> module</p>

</div>
</div>
</div>
</div>
 

